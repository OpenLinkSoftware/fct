<?vsp 
  if (val_vad_present) { 
    declare enable_personal_acl_ui int;
    enable_personal_acl_ui := 0;
    if (pacl_vad_present and __proc_exists('VAL.VAL.acl.rule.new') is not null)
      enable_personal_acl_ui := 1;
?>
        <!-- <div id="val_login_status"> -->
          <table style="width:100%;font-size:1em; border-spacing:0px;">
            <tr>
              <td>
                <?vsp 
		  if (val_serviceId is null or val_serviceId = 'nobody') { 
		?>
                  Not logged in: <a id="loginLink" href="/fct/login.vsp?returnto=<?vsp http_url(pageUrl); ?>">Login</a>
                <?vsp } else {
                  declare x, n varchar;
                  x := VAL.DBA.get_profile_url (val_serviceId);
                  n := coalesce (VAL.DBA.get_profile_name (val_serviceId), val_serviceId);
                  if (not x is null)
                    http (sprintf ('Logged in as: <a href="%s">%V</a>', x, n));
                  else
                    http ('Logged in as: ' || n);
                ?>
		  <?vsp
		    -- TO DO:
		    -- Logout is flaky when logged in via WebID. Some browsers don't support crypto.logout
		    -- The WebID in effect becomes sticky and logout fails.
		    -- For now disable the Logout option for WebID and force the user to close the browser window to end the session.
		    if (val_auth_method > 0 and val_auth_method <> 2) { ?>
		      | <a id="logoutLink" href="/val/logout.vsp?returnto=<?/pageUrl?>">Logout</a>
		      <?vsp
		      if (enable_personal_acl_ui) {
		      ?>
		        | <a id="acllink" title="Personal ACLs" href="/pacl/personal_acl_ui.vsp?res=<?vsp http_url(pageUrl); ?>">
			  <!-- <img border="0" src="/rdfdesc/images/item_prop.png" alt="Personal ACLs">--> 
			  Personal ACLs
			  </a>
		      <?vsp } ?>
		    <?vsp } ?>

                <?vsp } ?>
              </td>
            </tr>
          </table>
        <!-- </div> -->
<?vsp } ?>
